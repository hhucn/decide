image: clojure:lein-2.8.1

before_script:
  - lein deps

test:
  script:
    - lein test
  cache:
    key: "$CI_JOB_NAME"
    paths:
      - ~/.m2

cljs-tests:
  image: circleci/clojure:lein-2.8.1-node-browsers
  script:
    - npm install
    - npx shadow-cljs compile ci-tests
    - npx karma start --single-run
    - lein do clean, test-refresh :run-once # clean is needed in case AOT stuff is around
  cache:
    key: "$CI_JOB_NAME"
    paths:
      - ~/.m2
      - ./node_modules